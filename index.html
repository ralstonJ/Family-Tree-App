<html>
	<head>
		<title>Family Tree App by Ralston ALmeida </title>
		<link rel="icon" type="image/png" href="./icon.png">
		<link type="text/css" rel="stylesheet" href="Home.css" />
		<link rel="stylesheet" href="resources/qunit.css" type="text/css" media="screen" />
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<script type="text/javascript" src="resources/qunit.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>		
	</head>
	<body>
	<div class="top-div">
	<div class="div_txt"> Welcome to Family Tree</div>
	<select id="selectParent"> </select>
	<input  id="txtMemName" type="text"> </input>
	<button id="btn_Add">Add Node</button> 
	<button id="btn_Rename">Rename Node</button>
	<button id="btn_Delete">Delete Node</button>
	<button id="btn_Position">Position Node</button>
	<button id="btn_Get_Grand_Node">Get Grand-Parent Node</button>
	<div class="div_display">
	</div>
	<div class="div_warn">
	</div>

	<script>
	$(document).ready(function(){
		
		var i = 0
		var flyMem = new Array();
		
		function Person(name) 
		{
			// Lets node knwo if it has a parent
			this.parent = null;
			// key
			this.key = 0;
			
			// The data that is required to show
			this.name = name;
			
			this.firstChild = null;
			
			this.nextNode = null;
			
			this.prevNode = null;
			
			this.lastNode = null;
			// A count, to keep track of the number of children
			this.child = 0;

		}

			// function to clear objects from <select> and re-load. Also clear TextBox
		function ClearVal()
		{

			$("select").empty();
			$(".div_display").empty();
			$(".div_display").append("<p>Number of elements in the list " + flyMem.length +"</p>");	
			
			for(var key in flyMem){
				
				if(flyMem[key].name != null)
				{
					$("select").append("<option value='"+flyMem[key].key+"'>"+ flyMem[key].name +"</option>");
					$(".div_display").append("<p> Name:	" + flyMem[key].name + "	Parent:	" + flyMem[key].parent + "	NChild:	" + flyMem[key].child + "	FirstChild:	" + flyMem[key].firstChild + "	nextNode:	" + flyMem[key].nextNode + "	LastNode:	" + flyMem[key].lastNode + "	PrevNode:	" + flyMem[key].prevNode +"</p>");	
				}
			}
			
			$("input").val('');
		}

		//Qunit Test -- Add
		module("Test for add elements");
		test("",3,function(){
		
		AddVal("Jack"); 
			equals(flyMem[0].name,"Jack"," JAck accepted");
		AddVal("Sparrow"); 			
			equals(flyMem[1].name,"Sparrow"," Sparrow accepted");
			flyMem[1].parent = 0;
			equals(flyMem[1].parent,0," Sparrow accepted");
		});		


		// function to add node to tree
				
		function AddVal(txtMemName)
		{

			if(!txtMemName)
			{

				$(".div_warn").append("<p>Valid Name must be entered in TextBox</p>");	
				console.warn("Valid Name must be entered in TextBox");
				return;
			}
			
			flyMem[i++] = new Person(txtMemName);
			
			if($( "#selectParent option:selected" ).val())
			{

				var val_parent =$( "#selectParent option:selected" ).val();	
				flyMem[i-1].parent =  $("#selectParent").val();
				
				flyMem[i-1].key = i-1;
				flyMem[val_parent].child +=1;
				
				// Add key value as firstchild or nextNode and update lastNode
				if(!flyMem[val_parent].firstChild) flyMem[val_parent].firstChild = i-1;
				else flyMem[flyMem[val_parent].lastNode].nextNode = i-1;
			
				flyMem[i-1].prevNode = flyMem[val_parent].lastNode;
				flyMem[val_parent].lastNode = i-1;		
			}
			
		}
		
		function DeleteVal(id_flyMem){
			
			if(!flyMem[id_flyMem]){
				
				$(".div_warn").append("Delete opereation Cannot work with empty dropDown");
				console.warn("Delete opeartion Cannot work with empty dropDown");
				return;
			}
			
			var n_child = flyMem[id_flyMem].child; 
			
			
			if(n_child != 0)
			{	
					
					DeleteLastNode(id_flyMem);
					
			
			}		
			
				$(".div_warn").append("<p>" + flyMem[id_flyMem].name  +" has been deleted</p>");
				// decrement child count in parent by 1
				if(flyMem[id_flyMem].parent) flyMem[flyMem[id_flyMem].parent].child -=1;
				
				if(flyMem[id_flyMem].nextNode) flyMem[flyMem[id_flyMem].prevNode].nextNode = flyMem[id_flyMem].nextNode;
				
				
				if(flyMem[id_flyMem].prevNode )  flyMem[flyMem[id_flyMem].nextNode].prevNode = flyMem[id_flyMem].prevNode;
 				flyMem[flyMem[id_flyMem].parent].lastNode = flyMem[id_flyMem].prevNode;
				// empty array element
				flyMem.splice(id_flyMem,1);
			

		
		
		}
		
		function DeleteLastNode(id)
		{
		
			DeleteVal(flyMem[id].lastNode );
			
			
		}
		
		function RenameVal(txtMemName)
		{
			var id_flyMem = $("#selectParent").val();
			if(id_flyMem && txtMemName)
			{
				flyMem[id_flyMem].name = txtMemName;
				return;
			}
			
			$(".div_warn").append("Cannot work with empty TextBox or empty dropDown");
			console.warn("Cannot work with empty TextBox or empty dropDown");

		}
		
		
		$("#btn_Position").click(function(){
			$(".div_warn").empty();
			var id_flyMem = $("#selectParent").val();
			if(id_flyMem)
			{
				$(".div_warn").append("<p>Position of " + flyMem[id_flyMem].name + " : " + id_flyMem + "</p>");
				return;
			}
			
			$(".div_warn").append("Position button Cannot work with empty TextBox or empty dropDown");
			console.warn("Position button Cannot work with empty TextBox or empty dropDown");
			
			
		});
		$("#btn_Add").click(function(){
			
			$(".div_warn").empty();
			var txtMemName = $('input:text[id="txtMemName"]').val();
			AddVal(txtMemName);
			ClearVal();
		});
		
		$("#btn_Rename").click(function(){
			
			$(".div_warn").empty();
			var txtMemName = $('input:text[id="txtMemName"]').val();
			RenameVal(txtMemName);
			ClearVal();

		});
	  
	  
		$("#btn_Delete").click(function(){
			$(".div_warn").empty();
			var id_flyMem = $("#selectParent").val();
			DeleteVal(id_flyMem);
			ClearVal();
			
		});
		
		$("#btn_Get_Grand_Node").click(function(){
			
			$(".div_warn").empty();
			var id_flyMem = $("#selectParent").val();
			if(!flyMem[id_flyMem])
			{
				$(".div_warn").append("Get Grand Parent Node Cannot work with empty TextBox or empty dropDown");
				console.warn("Get Grand Parent Node Cannot work with empty TextBox or empty dropDown");
				return;
			}
			
			ClearVal();
				
			if(flyMem[id_flyMem].parent !=null &&flyMem[flyMem[id_flyMem].parent].parent !=null )
			{		
				alert("Grand parent exist!");
				
				$(".div_display").append("<p>Grand Parent of " +flyMem[id_flyMem].name + " is " + flyMem[flyMem[flyMem[id_flyMem].parent].parent].name + " </p>");
			
			}
			else
				alert("Grand parent does not exist!");
			
		
		});	
	  });
		QUnit.log = function(result, message)
		{
			if (window.console && window.console.log)
			{
				window.console.log(result +' :: '+ message);
			}
		} 
		module("Test for all the GUI elements");
		test( "All required elements exist", 6, function() {
			ok($("#selectParent").length != 0, "DropDown Box exists");
		    ok($("#txtMemName").length != 0, "TextBox exists");
		    ok($("#btn_Add").length != 0, "Add Button exists");
			ok($("#btn_Rename").length != 0, "Rename Button exists");
			ok($("#btn_Delete").length != 0, "Delete Button exists");
			ok($("#btn_Get_Grand_Node").length != 0, "Get Grand Parent exists");
		});
		module("Test Elements when user clicks on add button");
		test("All required element exist", 2,function(){
			
			ok($("input").length !=0," TextBox exists");
			ok($("input").empty()," TextBox is empty");		
			
			
			
		});

		</script>   
		</div>      
		<h1 id="qunit-header">QUnit Testing  Family Tree App</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests">
		</ol>
	</body>

</html>